{% liquid
  assign id = section.id
%}

<style>
  pqa-new{
    position: fixed;   
    width: 400px;
    right: 40px;
    bottom: 40px;
    z-index: 2;
    opacity: 0;
    transition: .4s;
    background: #ffffffed;
     @media screen and (max-width: 600px){
      right: 0px;
      bottom: 0px;
      width: 100%;
    }
  }
  pqa-new.sticky-visible{
    right: 40px;
    bottom: 40px!important;
    opacity: 1;
    {% comment %} border-top: 1px solid #00000026;
    border-bottom: 1px solid #1F2937; {% endcomment %}
    bottom: unset;
    background: #fff;
    z-index: 5;
    @media screen and (max-width: 600px){
      right: 0px;
      bottom: 0px!important;
    }
  }
  {% comment %} pqa-new{
    position: fixed;
    /* top: -200px; */
    left: 0;
    width: 100%;
    /* background: #fff; */
    z-index: 2;
    opacity: 0;
    transition: .4s;
    background: #ffffffed;
  }
  pqa-new.sticky-visible{
    top: 81px;
    opacity: 1;
    border-top: 1px solid #00000026;
    border-bottom: 1px solid #1F2937;
    bottom: unset;
    background: #fff;
    z-index: 5;
    @media screen and (max-width: 600px){
      top: unset;
      bottom: 0;
    }
  } {% endcomment %}
  pqa-new .page-width{
    @media screen and (max-width: 800px){
      padding: 0;
      max-width: 100%;
    }
  }
  .pqa-new-wrapper{
    {% comment %} display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: 24px;
    @media screen and (max-width: 800px){
      grid-template-columns: minmax(0,1fr);
    } {% endcomment %}
  }

  .pqa-new-title{
    display: flex;
    box-sizing: border-box;
    gap: 12px;
    align-items: center;

   @media screen and (max-width: 800px){
     display: none;
   }
  }
  .pqa-new-title img{
    display: block;
    max-width: 100%;
    height: auto;
    width: 60px;
    aspect-ratio: 4/5;
    object-fit: cover;
  }
  .pqa-new-title .qa-title{
    color: #000;

    /* Paragraph/M */
    font-family: var(--font-family-Title);
    font-size: var(--Font-Size-Paragraph-Large);
    font-style: normal;
    font-weight: 400;
    line-height: var(--Line-Height-Paragraph-Large); /* 150% */
    margin: 0;
  }
  .pqa-new-title .qa-price{
    margin: 0;
    color: var(--Content-Base-main, #1F2937);
    font-family: var(--font-body-family);
    /* Paragraph/XS */
    {% comment %} font-family: var(--font-family-Control); {% endcomment %}
      font-size: var(--Font-Size-Paragraph-Small, 12px);
    font-style: normal;
    font-weight: 400;
    line-height: var(--Line-Height-Paragraph-Tiny, 16px); /* 133.333% */
    display: none;
  }
  .pqa-new-variants{
    {% comment %} display: grid;
    grid-template-columns: auto auto;
    align-items: center;
    gap: 24px;
    justify-self: center; {% endcomment %}
  }
  pinfo-variant-picker.--quick-add-variant-picker {
      display: grid;
      grid-template-columns: auto auto;
      align-items: center;
      gap: 24px;
      justify-self: center;
      max-width: max-content;
      @media(max-width: 768px){
        max-width: 100%;
      }
  }
  .pqa-container pinfo-variant-picker .pinfo-variants-options:not(:last-child) {
    margin: 0;
  }
  .pqa-new-option select{
    width: 100%;
    color: #000;
        font-family: var(--font-body-family);
    font-size: var(--Font-Size-Paragraph-Tiny, 12px);
    font-style: normal;
    font-weight: 400;
    line-height: var(--Line-Height-Paragraph-Tiny, 16px); /* 133.333% */
    {% comment %} cursor: url(https://cdn.shopify.com/s/files/1/0012/9954/6178/files/asas.png?v=1754903011) 0 0, auto; {% endcomment %}
    {% comment %} cursor: pointer; {% endcomment %}
    -webkit-appearance: none; /* Fix for Safari */
    -moz-appearance: none; /* Fix for Firefox */
    appearance: none; /* Fix for other browsers */

    background: url('data:image/svg+xml;utf8,<svg fill="%23000000" width="20px" height="20px" viewBox="-5 -8 24 24" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin"><path d="M7.071 5.314l4.95-4.95a1 1 0 1 1 1.414 1.414L7.778 7.435a1 1 0 0 1-1.414 0L.707 1.778A1 1 0 1 1 2.121.364l4.95 4.95z"/></svg>');
    background-repeat: no-repeat;
    background-position: top 50% right 8px;
    background-size: 16px;

    min-width: 134px;
    max-width: max-content;

    box-sizing: border-box;
    padding: 8px 8px;
    border: 1px solid #1F2937;
    /* border-radius: 32px; */
    padding-right: 25px;
  }

  .pqa-new-option select:focus{
    border: none;
    outline: none;
    box-shadow: none;
    border: 1px solid #004027bf;
  }
  .pqa-new-form button{
    display: block;
    width: 100%;
    border-radius: var(--rounded-none, 0px);
    {% comment %} background: #004027; {% endcomment %}
        {% comment %} background: linear-gradient(90deg, #010D05 0%, #1F2937 100%); {% endcomment %}
        background: #212b36;
    color: #FFF;
    text-align: center;
    font-family: var(--font-family-Body);
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 14px;
    text-transform: uppercase;
    text-decoration: none;
    box-sizing: border-box;
    border: none;
    padding: 12px 40px;
    border: 1px solid transparent;
    @media(max-width: 768px ) {
      {% comment %} padding-block: 20px;       {% endcomment %}
    }
  }
  .pqa-new-form button:hover {
    @media(min-width: 768px){
      {% comment %} background: #fff;
    color: #1F2937!important;
    border: 1px solid #1F2937; {% endcomment %}
    }

  }
  .pqa-new-form button::after, .pqa-new-form button::before {
    content: unset !important;
  }

  @media screen and (max-width: 800px){
    #shopify-section-{{ id }}{
      {% comment %} display: none; {% endcomment %}
    }
    .pqa-container{
      {% comment %} display: none; {% endcomment %}
       max-width: 100vw;
    }
    .pqa-new-wrapper{
      grid-gap: 0;
    }
    .pqa-new-form{
      {% comment %} display: none; {% endcomment %}
    }
    .pqa-new-form button{
      padding: 14px 12px;
    }
    .pqa-new-title, .pqa-new-variants{
      padding: 8px;
    }
    .pqa-new-option select{
      font-size: 11px;
      min-width: 100%;
      max-width: 100%;
      padding-right: 10px;
    }
    .pqa-new-variants{
      display: grid;
      {% comment %} grid-template-columns: minmax(0,2fr) minmax(0,1fr); {% endcomment %}
      grid-template-columns: minmax(0,1fr);
      gap: 12px;
      width: 100%;
    }
  }
#shopify-section-{{ id }}{
.pqa-new-variants{
  display: none;
}
.pqa-new-wrapper {
    display: flex;
    flex-direction: column;
    gap: var(--Spacing-Container-md);
    box-sizing: border-box;
    padding: 10px;
    border: 1px solid #e7e9eb;
    box-shadow: 0 0 #0000, 0 0 #0000, 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);
}

}
  
</style>

<div class="pqa-container" id="pqa-container">
  <pqa-new class="">
    <div class="page-width-">
      <div class="pqa-new-wrapper">
        <div class="pqa-new-title">
          {% unless product.selected_or_first_available_variant.featured_image == blank %}
            {{ product.selected_or_first_available_variant.featured_image | image_url: width: 100 | image_tag }}
          {% endunless %}
          <div>
            <p class="qa-title">{{ product.title }}</p>
            <p class="qa-price">{{ product.selected_or_first_available_variant.price | money }}</p>
          </div>
        </div>
        <div class="pqa-new-variants">
          <pinfo-variant-picker class="--quick-add-variant-picker">
            {% for option in product.options_with_values %}
              <div class="pinfo-variants-options">
                <div class="pqa-new-option">
                  <select name="{{ option.name }}" class="pinfo-option-value">
                    {% for value in option.values %}
                      <option
                        {% if value.selected %}
                          selected
                        {% endif %}
                        {% unless value.available %}
                          disabled
                        {% endunless %}
                        value="{{ value.name }}"
                        data-variant-url="{{ value.variant.url }}"
                      >
                        {% if value.name == 'SML' %}
                          S
                        {% elsif value.name == 'MED' %}
                          M
                        {% elsif value.name == 'LRG' %}
                          L
                        {% elsif value.name == 'XLG' %}
                          XL
                        {% else %}
                          {{ value.name }}
                        {% endif %}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            {% endfor %}
          </pinfo-variant-picker>
        </div>
        <div class="pqa-new-form">
          <button
            class="button"
            data-availabilty="{{ product.selected_or_first_available_variant.available }}"
          >
            {% if product.selected_or_first_available_variant.available %}
              Add To Cart - {{ product.selected_or_first_available_variant.price | money }}
            {% else %}
              Notify Me
            {% endif %}
          </button>
        </div>
      </div>
    </div>
  </pqa-new>
</div>

{% comment %} <script>
  document.addEventListener('DOMContentLoaded', function () {
    let lastScrollY = window.scrollY;
    let infoHeight = document.querySelector('.pinfo-wrapper').scrollHeight;
    const footer = document.querySelector('.footer__section');
    const pqaNewElement = document.querySelector('pqa-new');

    console.log('DOM fully loaded and parsed');
    window.addEventListener('scroll', function () {
      {% comment %} console.log('Scrolled:', window.scrollY, infoHeight); {% endcomment %}
      if (window.scrollY >= infoHeight) {
        pqaNewElement.classList.add('sticky-visible');
        if (footer) {
          footer.parentElement.style.paddingBottom = '100px';
        }
      } else {
        pqaNewElement.classList.remove('sticky-visible');
        if (footer) {
          footer.parentElement.style.paddingBottom = '0px';
        }
      }
    });
  });
</script>  {% endcomment %}


<script>
  document.addEventListener('DOMContentLoaded', function () {
    const pqaNewElement = document.querySelector('pqa-new');
    const targetElement = document.querySelector('.pinfo-add-to-cart');
    const footer = document.querySelector('.footer__section');
    let lastScrollY = window.scrollY;

    if (!targetElement || !pqaNewElement) {
      console.error('Required elements not found');
      return;
    }

    function getScrollDirection() {
      const currentScrollY = window.scrollY;
      const direction = currentScrollY > lastScrollY ? 'down' : 'up';
      lastScrollY = currentScrollY;
      return direction;
    }

    setTimeout(() => {
      const targetRect = targetElement.getBoundingClientRect();
      const pqaRect = pqaNewElement.getBoundingClientRect();
      const scrollPosition = window.scrollY + window.innerHeight;
      if (scrollPosition >= targetRect.top + window.scrollY && targetRect.top > pqaRect.bottom) {
        pqaNewElement.classList.add('sticky-visible');
        if (footer) {
          footer.parentElement.style.paddingBottom = '100px';
        }
      }
    }, 100);

    const observer = new IntersectionObserver(
      (entries) => {
        const scrollDirection = getScrollDirection();
        entries.forEach((entry) => {
          if (!entry.isIntersecting) {
            if (scrollDirection === 'down') {
              pqaNewElement.classList.add('sticky-visible');
              if (footer) {
                footer.parentElement.style.paddingBottom = '100px';
              }
            }
          } else {
            pqaNewElement.classList.remove('sticky-visible');
            if (footer) {
              footer.parentElement.style.paddingBottom = '0px';
            }
          }
        });
      },
      {
        root: null,
        threshold: 0,
      }
    );

    observer.observe(targetElement);
  });
</script>

