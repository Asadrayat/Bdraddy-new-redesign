<product-card class="product-card" data-product-handle="{{ product.handle }}" data-product-url="{{ product.url }}">
  <!-- Hidden product data for JS -->
  <script type="application/json" data-product-json>
    {{ product | json }}
  </script>

  <div class="product-card__container {% if product.media.size > 1 %}product-card__container--hoverable{% endif %}">
    <div class="product-card__content">
      <!-- Media Section -->
      <div class="product-card__media">
        <!-- Primary product image link -->
        <a href="{{ product.url }}" class="product-card__image-link js-product-link">
          {% if product.featured_image %}
            {{
              product.featured_image
              | image_url: width: 600
              | image_tag:
                class: 'product-card__primary-image',
                loading: 'lazy',
                widths: '300, 400, 500, 600',
                sizes: '(max-width: 767px) 100vw, 50vw'
            }}
          {% endif %}
          {% if product.media[1] != null %}
            {{
              product.media[1]
              | image_url: width: product.media[1].width
              | image_tag: class: 'product-card__secondary-image', loading: 'lazy'
            }}
          {% endif %}
        </a>

        <!-- Swiper Gallery (lazy initialized) -->
        <div
          class="product-card__gallery swiper-container--lazy"
          data-media-count="{{ product.media.size }}"
          aria-hidden="true"
        >
          <div class="swiper">
            <div class="swiper-wrapper">
              {% for media in product.media %}
                {% assign variant_for_media = product.variants | where: 'featured_image', media | first %}
                <div
                  class="swiper-slide {% if forloop.first %}first-swiper-slide{% elsif forloop.index == 2 %}second-swiper-slide{% endif %}"
                  data-media-id="{{ media.id }}"
                  data-media-position="{{ forloop.index }}"
                  data-variant-id="{{ variant_for_media.id | default: '' }}"
                >
                  <a href="{{ product.url }}">
                    {{
                      media
                      | image_url: width: 600
                      | image_tag:
                        class: 'product-card__gallery-image swiper-lazy',
                        loading: 'lazy',
                        widths: '300, 400, 500, 600',
                        sizes: '(max-width: 767px) 100vw, 50vw'
                    }}
                  </a>
                </div>
              {% endfor %}
            </div>

            <div class="swiper-pagination__cardv1 hidden"></div>

            <div class="desktop__only">
              <button class="swiper-button-prev">{% render 'card-icons', name: 'prev' %}</button>
              <button class="swiper-button-next">{% render 'card-icons', name: 'next' %}</button>
            </div>
          </div>
        </div>

        <!-- Size Swatches -->
        {% render 'size-swatch-v1', product: product %}
      </div>

      <!-- Product Info -->
      <div class="product-card__details">
        <!-- Color Swatches -->
        {% render 'color-swatch-v1', product: product %}
        <div class="product-card__header">
          <h3 class="product-card__title">
            <a href="{{ product.url }}">{{ product.title | escape }}</a>
          </h3>
          {% if product.metafields.descriptors.subtitle %}
            <p class="product-card__subtitle">{{ product.metafields.descriptors.subtitle }}</p>
          {% endif %}
        </div>

        <!-- Pricing -->
        <div class="product-card__pricing" data-price-container>
          {% render 'new-price', product: product %}
        </div>
      </div>
    </div>
  </div>
</product-card>
