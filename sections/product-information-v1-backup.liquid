{% # render 'pfm', section: section %}

{% liquid
  assign id = section.id

  for option in product.options_with_values
    if option.name == 'Color' or option.name == 'color' or option.name == 'COLOR'
      assign color_option = 'option' | append: option.position
    endif
  endfor
  assign selected_color = product.selected_or_first_available_variant[color_option] | downcase
  assign is_selected_variant = product.selected_or_first_available_variant.id

  assign is_alt_text = false
  for media in product.media
    assign alt_txt = media.alt | split: '#' | first | strip | downcase
    if alt_txt == selected_color
      assign is_alt_text = true
    endif
  endfor
%}

{% comment %}
  <div id="product-information-container" data-id="{{ section.id }}">
    {{ 'product-information-v1.css' | asset_url | stylesheet_tag }}
    <product-information data-update-url="true">
      <div class="pinfo-wrapper page-width">
        <product-info-media>
          {% case section.settings.image_style %}
            {% when 'slider' %}
              <div class="pinfo-slider-wrapper">
                <div class="swiper pinfo-thumb-swiper">
                  <div class="swiper-wrapper">
                    {% for media in product.media %}
                      <div data-media="{{ media.id }}" class="swiper-slide pdp-media">
                        {% unless media == blank %}
                          <picture class="pinfo-thumb-pic">
                            <source media="(max-width: 600px)" srcset="{{ media | image_url: width: 500 }}">
                            <source media="(max-width: 1024px)" srcset="{{ media | image_url: width: 1024 }}">
                            {% if forloop.first %}
                              {{ media | image_url: width: media.width | image_tag }}
                            {% else %}
                              {{ media | image_url: width: media.width | image_tag: loading: 'lazy' }}
                            {% endif %}
                          </picture>
                        {% endunless %}
                      </div>
                    {% endfor %}
                  </div>
                </div>
                <div class="swiper pinfo-gallery-swiper">
                  <div class="swiper-wrapper">
                    {% for media in product.media %}
                      <div class="swiper-slide">
                        {% unless media == blank %}
                          <picture class="pinfo-gallery-pic">
                            <source
                              media="(max-width: 600px)"
                              srcset="{{ media | image_url: width: 400, height: 200, crop: 'top'}}"
                            >
                            {% if forloop.index >= 2 %}
                              {{ media | image_url: width: 500, height: 200, crop: 'top' | image_tag: loading: 'lazy' }}
                            {% else %}
                              {{ media | image_url: width: 500, height: 200, crop: 'top' | image_tag }}
                            {% endif %}
                          </picture>
                        {% endunless %}
                      </div>
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% when 'stack' %}
{% endcomment %}
{% comment %}
  {% liquid
    assign media_size = product.media.size
    assign mod = media_size | modulo: 2
    if mod == 0
      assign is_even = true
    else
      assign is_even = false
    endif
  %}
  <div class="info-media-stack-wrapper">
    {% for m in product.media %}
      {% liquid
        assign media = m
        if forloop.first and product.selected_or_first_available_variant.featured_media != blank and m.media_type == 'image'
          assign media = product.selected_or_first_available_variant.featured_media
        endif
      %}
      {% case media.media_type %}
        {% when 'image' %}
          <div
            data-media="{{ media.id }}"
            class="pdp-media info-media-image {% if forloop.first %}first{% endif %} {% if forloop.last and is_even %}last{% endif %}"
          >
            <picture class="pinfo-stack-picture">
              <source
                media="(max-width: 600px)"
                srcset="{{ media | image_url: width: 400 }}"
              >
              {% if forloop.index >= 2 %}
                {{ media | image_url: width: 800 | image_tag: loading: 'lazy' }}
              {% else %}
                {{ media | image_url: width: 800 | image_tag }}
              {% endif %}
            </picture>
          </div>
        {% when 'video' %}
          <div
            data-media="{{ media.id }}"
            class="pdp-media info-media-image info-media-video {% if forloop.first %}first{% endif %} {% if forloop.last and is_even %}last{% endif %}"
          >
            {{
              media
              | video_tag: image_size: '400x', autoplay: true, loop: true, muted: true, controls: true
            }}
          </div>
      {% endcase %}
    {% endfor %}
  </div>
{% endcomment %}
{% comment %}

             {% liquid
                assign media_size = product.media.size
                assign mod = media_size | modulo: 2
                if mod == 0
                  assign is_even = true
                else
                  assign is_even = false
                endif
              %}
              <div class="info-media-stack-wrapper pdp-media-lg">
                {% for m in product.media %}
                  {% liquid
                    assign alt_text = m.alt | split: '#' | first | strip | downcase
                    assign media = m
                    if forloop.first and product.selected_or_first_available_variant.featured_media != blank and m.media_type == 'image'
                      assign media = product.selected_or_first_available_variant.featured_media
                    endif
                  %}

                  {% if is_alt_text and alt_text == selected_color and is_selected_variant != blank %}
                    {% case media.media_type %}
                      {% when 'image' %}
                        <div
                        data-media="{{ media.id }}"
                        class="pdp-media info-media-image {% if forloop.first %}first{% endif %} {% if forloop.last and is_even %}last{% endif %}">
                          <picture class="pinfo-stack-picture">
                            <source
                              media="(max-width: 600px)"
                              srcset="{{ media | image_url: width: 400 }}"
                            >
                            {% if forloop.index >= 2 %}
                              {{ media | image_url: width: 800 | image_tag: loading: 'lazy' }}
                            {% else %}
                              {{ media | image_url: width: 800 | image_tag }}
                            {% endif %}
                          </picture>
                        </div>
                      {% when 'video' %}
                        <div
                        data-media="{{ media.id }}"
                        class="pdp-media info-media-image info-media-video {% if forloop.first %}first{% endif %} {% if forloop.last and is_even %}last{% endif %}">
                          {{
                            media
                            | video_tag: image_size: '400x', autoplay: true, loop: true, muted: true, controls: true
                          }}
                        </div>
                    {% endcase %}
                  {% endif %}
                  {% if is_alt_text == false or is_selected_variant == blank %}
                    {% case media.media_type %}
                      {% when 'image' %}
                        <div
                        data-media="{{ media.id }}"
                        class="pdp-media info-media-image {% if forloop.first %}first{% endif %} {% if forloop.last and is_even %}last{% endif %}">
                          <picture class="pinfo-stack-picture">
                            <source
                              media="(max-width: 600px)"
                              srcset="{{ media | image_url: width: 400 }}"
                            >
                            {% if forloop.index >= 2 %}
                              {{ media | image_url: width: 800 | image_tag: loading: 'lazy' }}
                            {% else %}
                              {{ media | image_url: width: 800 | image_tag }}
                            {% endif %}
                          </picture>
                        </div>
                      {% when 'video' %}
                        <div
                        data-media="{{ media.id }}"
                        class="pdp-media info-media-image info-media-video {% if forloop.first %}first{% endif %} {% if forloop.last and is_even %}last{% endif %}">
                          {{
                            media
                            | video_tag: image_size: '400x', autoplay: true, loop: true, muted: true, controls: true
                          }}
                        </div>
                    {% endcase %}
                  {% endif %}
                {% endfor %}
              </div>
              <div class="pdp-media-sm">
                <div class="swiper">
                  <div class="swiper-wrapper">
                    {% assign media_count = 0 %}
                    {% for media in product.media %}
                      {% liquid
                        assign alt_text = media.alt | split: '#' | first | strip | downcase
                        if forloop.first and product.selected_or_first_available_variant.featured_media != blank and media.media_type == 'image'
                          assign media = product.selected_or_first_available_variant.featured_media
                        endif
                      %}
                      {% if is_alt_text and alt_text == selected_color and is_selected_variant != blank %}
                        {% assign media_count = media_count | plus: 1 %}
                        <div class="swiper-slide">
                          {% case media.media_type %}
                            {% when 'image' %}
                              <div
                              data-media="{{ media.id }}"
                              class="pdp-media pdp-media-image">
                                <picture>
                                  <source
                                    media="(max-width: 600px)"
                                    srcset="{{ media | image_url: width: 400 }}"
                                  >
                                  {% if forloop.index >= 2 %}
                                    {{ media | image_url: width: 800 | image_tag: loading: 'lazy' }}
                                  {% else %}
                                    {{ media | image_url: width: 800 | image_tag }}
                                  {% endif %}
                                </picture>
                              </div>
                            {% when 'video' %}
                              <div
                              data-media="{{ media.id }}"
                              class="pdp-media pdp-media-video">
                                {{
                                  media
                                  | video_tag: image_size: '400x', autoplay: true, loop: true, muted: true, controls: true
                                }}
                              </div>
                          {% endcase %}
                        </div>
                      {% endif %}
                      {% if is_alt_text == false or is_selected_variant == blank %}
                        {% assign media_count = media_count | plus: 1 %}
                        <div class="swiper-slide">
                          {% case media.media_type %}
                            {% when 'image' %}
                              <div
                              data-media="{{ media.id }}"
                              class="pdp-media pdp-media-image">
                                <picture>
                                  <source
                                    media="(max-width: 600px)"
                                    srcset="{{ media | image_url: width: 400 }}"
                                  >
                                  {% if forloop.index >= 2 %}
                                    {{ media | image_url: width: 800 | image_tag: loading: 'lazy' }}
                                  {% else %}
                                    {{ media | image_url: width: 800 | image_tag }}
                                  {% endif %}
                                </picture>
                              </div>
                            {% when 'video' %}
                              <div
                              data-media="{{ media.id }}"
                              class="pdp-media pdp-media-video">
                                {{
                                  media
                                  | video_tag: image_size: '400x', autoplay: true, loop: true, muted: true, controls: true
                                }}
                              </div>
                          {% endcase %}
                        </div>
                      {% endif %}
                    {% endfor %}
                  </div>
                  <div style="display: none !important" class="swiper-scrollbar"></div>
                  <div style="display: none !important" class="swiper-counter hidden">
                    <span class="current">1</span> / <span class="total">{{ media_count }}</span>
                  </div>
                </div>
              </div>

          {% endcase %}
        </product-info-media>
        <product-info-content>
          <div class="pinfo-top">
            {% for block in section.blocks %}
              {% case block.type %}
                {% when '@app' %}
                  <div class="pinfo-app-block">{% render block %}</div>
                {% when 'title' %}
                  <div>
                    <h2 class="pinfo-title">{{ product.title | downcase }}</h2>
                  </div>
                {% when 'price' %}
                  {% render 'pinfo-price-v1' %}
              {% endcase %}
            {% endfor %}
          </div>
          {% for block in section.blocks %}
            {% case block.type %}
              {% when 'buy-button' %}
                {% render 'pinfo-buy-button', product: product, block: block %}
              {% when 'variant-picker' %}
                {% render 'pinfo-variant-picker-v1', product: product, block: block %}
            {% endcase %}
          {% endfor %}
          {% render 'pinfo-collapsible-v1', section: section %}
          {% for block in section.blocks %}
            {% case block.type %}
              {% when 'bundle' %}
                {% render 'pinfo-bundle-products-v1', product: product, block: block %}
            {% endcase %}
          {% endfor %}
        </product-info-content>
      </div>
      {% if section.settings.lightbox %}
        {% render 'media-lightbox', section: section, product: product %}
      {% endif %}
    </product-information>
  </div>
  <script>
    window.productVariants = {{ product.variants | json }};
  </script>
{% endcomment %}

{% schema %}
{
  "name": "Product Info Backup",
  "class": "sticky--selector",
  "settings": [
    {
      "type": "select",
      "id": "image_style",
      "label": "Product Media",
      "options": [
        {
          "value": "slider",
          "label": "Slider"
        },
        {
          "value": "stack",
          "label": "Stack"
        }
      ],
      "default": "stack"
    },
    {
      "type": "checkbox",
      "id": "lightbox",
      "label": "Enable Lightbox",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1
    },
    {
      "type": "variant-picker",
      "name": "Variant Picker",
      "limit": 1
    },
    {
      "type": "buy-button",
      "name": "Buy Button",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "dynamic_checkout_button",
          "label": "Dynamic Checkout Button",
          "default": false
        },
        {
          "type": "text",
          "id": "dynamic_checkout_button_text",
          "label": "Dynamic Checkout Button Text",
          "default": "Shop with"
        }
      ]
    },
    {
      "type": "bundle",
      "name": "Bundle Products",
      "limit": 1
    },
    {
      "type": "collapsible",
      "name": "Collapsible Tab",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Lorem Insum Dollar."
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content"
        },
        {
          "type": "page",
          "id": "page",
          "label": "Page Content",
          "info": "Select Page"
        }
      ]
    },
  ]
}
{% endschema %}
