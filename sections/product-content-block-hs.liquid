{% liquid
  assign id = section.id
%}

<style>
  #shopify-section-{{id}} {
    box-sizing: border-box;
    margin-top: {{section.settings.margin_top | append: 'px'}};
    margin-bottom: {{section.settings.margin_bottom | append: 'px'}};
    padding-top: {{section.settings.padding_top | append: 'px'}};
    padding-bottom: {{section.settings.padding_bottom | append: 'px'}};
  }
  .wrapper-{{ id }} {
    position: sticky;    position: static;
    top: 48px;
    @media(max-width: 768px) {
      position: static;
    }
  }
  .wrapper-{{ id }} > div {
    /* max-width: 70%; */
    margin: auto;
    /* padding-block: 48px; */
    @media(max-width: 768px) {
      max-width: 100%;
      margin: auto;
      padding: 0 15px;
    }
  }
  .sec-{{ id }} {
    .faq-container-{{ id }} {
      display: grid;
      grid-template-columns: minmax(0,8fr) minmax(0,7fr);
      gap: var(--Spacing-Container-lg, 40px);
      padding-block: var(--Spacing-Container-md, 24px);
      justify-content: center;
      position: relative;
      align-items: flex-start;
      @media(max-width: 768px) {
        flex-wrap: wrap;
        grid-template-columns: minmax(0,1fr);
      }
      .pd__feature-image img{
        width: 100%;
        height: auto;
        object-fit: cover;
      }
    }
    .pd__feature-image {
      /* flex: 0 0 50%; */
      position: sticky;
      top: 48px;
      @media(max-width: 768px) {
        display: none;
      }
    }
    .faq__wrapp {
      border-bottom: 1px solid #efefef;
    }
    .faq__wrapp:first-child {
      border-top: 0;
    }
    .faq__wrapp:last-child {
      border-bottom: 1px solid #efefef;;
    }
    [data-faq-content] {
       overflow: hidden;
       opacity: 0;
       max-height: 0;
       transition: all 0.4s ease-in-out;
    }
    [data-faq-content] .richtext p:nth-child(1){
      margin-top: 0;
    }
    [data-faq-content] .richtext p:first-of-type {
      margin-top: 0;
    }

    [data-faq-content].active {
      opacity: 1;
    }
    .intro {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      h3 {
        margin: 0;
        padding: 20px 0;
        color: var(--Content-Base-main, #1F2937);
        font-family: var(--font-family-Body, Archivo);
        font-size: var(--Font-Size-Paragraph-Regular, 16px);
        font-style: normal;
        line-height: var(--Line-Height-Paragraph-Regular, 24px);
        text-transform: uppercase;
        font-weight: 700;
        @media(max-width: 768px) {
          padding: 16px 0;
          font-size: 17px;
        }
      }
      .icons {
        font-size: var(--Font-Size-Heading-H3);
        line-height: var(--Line-Height-Heading-H3);
        font-family: var(--font-family-Title);
        padding: 20px;
        position: relative;
      }
      .icons span {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        transform: translate(-50%, -50%);
      }
      .accordion_arrow svg{
        transition: all 0.4s;
      }
    }
    .intro.active{
      .accordion_arrow {
        svg {
          rotate: 180deg;
        }
      }
    }
    .content{
      .richtext{
        color: var(--Content-Base-main, #1F2937);
        font-family: var(--font-family-Body, Archivo);
        font-size: var(--Font-Size-Paragraph-Small, 14px);
        font-style: normal;
        font-weight: 250;
        line-height: var(--Line-Height-Paragraph-Small, 20px); /* 142.857% */
      }
    }


    .info---wrapper{
      padding-block: 48px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: var(--Spacing-Container-md, 24px);
      align-self: stretch;
      .info---content {
          display: grid;
          grid-template-columns: minmax(120px,1fr) minmax(0, 3fr);
          gap: 48px;
      }
      .info---title{
        margin: 0;
        text-transform: uppercase;
        color: var(--Content-Base-main, #1F2937);
        font-family: var(--font-family-Body, Archivo);
        font-size: var(--Font-Size-Paragraph-Regular, 16px);
        font-style: normal;
        font-weight: 700;
        line-height: var(--Line-Height-Paragraph-Regular, 24px); /* 150% */        
      }
      .info---description p{
        margin: 0;
        color: var(--Content-Base-main, #1F2937);
        font-family: var(--font-family-Body, Archivo);
        font-size: var(--Font-Size-Paragraph-Regular, 16px);
        font-style: normal;
        font-weight: 250;
        line-height: var(--Line-Height-Paragraph-Regular, 24px); /* 150% */
      }
    }
    .img--container--one{
      display: grid;
      grid-template-columns: minmax(0,1fr);
      gap: 16px;
      @media(max-width: 768px) {
        display: none;
      }
    }
    .img--container--two{
      display: grid;
      grid-template-columns: repeat(2,minmax(0,1fr));
      gap: 16px;
      @media(max-width: 768px) {
        display: none;
      }
    }
    .img--container--three{
      display: grid;
      grid-template-columns: repeat(2,minmax(0,1fr));
      gap: 16px;
      .img--wrapper:last-child{
        grid-column: 1 / -1;
      }
      @media(max-width: 768px) {
        display: none;
      }
    }
    .img--wrapper img{
      width: 100%;
      height: auto;
      object-fit: cover;
    }
    .mbl--img---container{
      display: none;
      @media(max-width: 768px) {
        display: block;
      }
    }
  }
  @media(max-width: 600px) {
    #shopify-section-{{id}} {
      margin-top: {{section.settings.margin_top_m | append: 'px'}};
      margin-bottom: {{section.settings.margin_bottom_m | append: 'px'}};
      padding-top: {{section.settings.padding_top_m | append: 'px'}};
      padding-bottom: {{section.settings.padding_bottom_m | append: 'px'}};
    }
    .faq-container-{{ id }}.page-width {
      padding: 0;
    }
  }
</style>

<div class="sec-{{ id }}">
  <div class="faq-container-{{ id }} {% unless section.settings.full_width %}page-width{% endunless %}">
    <div class="wrapper-{{ id }}">
      <div class="info---wrapper">
        {% for block in section.blocks %}
          {% if block.type == 'info' %}
            <div class="info---content">
              <div class="info---title">{{ block.settings.title }}</div>
              <div class="info---description">{{ block.settings.info }}</div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
      <div>
        {% for block in section.blocks -%}
          {% if block.type == 'accordion' %}
            <div class="faq__wrapp">
              <div class="intro" data-faq-title>
                {% unless block.settings.title == blank %}
                  <h3>{{ block.settings.title }}</h3>
                  <div class="icons">
                    <span class="accordion_arrow">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="11" viewBox="0 0 24 11" fill="none">
                        <path d="M18.6639 2.87488L18.4135 3.43232L11.999 8.67736L11.9972 8.67884L11.9954 8.67736L5.58097 3.43232L5.33057 2.87488L11.9954 5.83197L11.9969 5.83257H11.9975L11.999 5.83197L18.6639 2.87488Z" fill="black"/>
                      </svg>
                    </span>
                  </div>
                {% endunless %}
              </div>
              <div class="content" data-faq-content>
                {% if block.settings.rte != blank %}
                  <div class="richtext">{{ block.settings.rte }}</div>
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    {% comment %}
      {% unless product.selected_or_first_available_variant.featured_image == blank %}
        <div class="pd__feature-image">
          {{
            product.selected_or_first_available_variant.featured_image
            | image_url: width: product.selected_or_first_available_variant.featured_image.width
            | image_tag
          }}
        </div>
      {% else %}
        <div class="pd__feature-image">
          {{ product.featured_image | image_url: width: product.featured_image.width | image_tag }}
        </div>
      {% endunless %}
    {% endcomment %}

    {% assign count_block = 0 %}
    {% for block in section.blocks %}
      {% if block.type == 'image' %}
        {% assign count_block = count_block | plus: 1 %}
      {% endif %}
    {% endfor %}

    {% if count_block == 1 %}
      <div class="pd__feature-image img--container--one">
        {% for block in section.blocks %}
          {% if block.type == 'image' %}
            <div class="img--wrapper">
              {{ block.settings.img | image_url: width: block.settings.img.width | image_tag }}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% elsif count_block == 2 %}
      <div class="pd__feature-image img--container--two">
        {% for block in section.blocks %}
          {% if block.type == 'image' %}
            <div class="img--wrapper">
              {{ block.settings.img | image_url: width: block.settings.img.width | image_tag }}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% else %}
      <div class="pd__feature-image img--container--three">
        {% for block in section.blocks %}
          {% if block.type == 'image' %}
            <div class="img--wrapper">
              {{ block.settings.img | image_url: width: block.settings.img.width | image_tag }}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
    <div class="mbl--img---container">
      <div class="swiper swiper-{{ section.id }}">
        <div class="swiper-wrapper">
          {% for block in section.blocks %}
            {% if block.type == 'image' %}
              <div class="swiper-slide">
               <div class="img--wrapper">
                {{ block.settings.img | image_url: width: block.settings.img.width | image_tag }}
              </div>       
              </div>
          {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>    
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    new Swiper(".swiper-{{ section.id }}", {
      slidesPerView: 1.2,
      spaceBetween: 24,
    });
  });
</script>

<script>
const initAccordion = () => {
  const faqIntros = document.querySelectorAll("[data-faq-title]");
  const faqContents = document.querySelectorAll("[data-faq-content]");

  const toggleAccordion = (faqIntro, faqContent) => {
    const isActive = faqIntro.classList.contains("active");

    // Close all accordions
    faqIntros.forEach((fi) => fi.classList.remove("active"));
    faqContents.forEach((fc) => {
      fc.classList.remove("active");
      fc.style.maxHeight = null;
      fc.setAttribute("aria-hidden", "true");
    });

    // Toggle the clicked accordion
    if (!isActive) {
      faqIntro.classList.add("active");
      faqContent.classList.add("active");
      faqContent.style.maxHeight = `${faqContent.scrollHeight}px`;
      faqContent.setAttribute("aria-hidden", "false");
    }
  };

  faqIntros.forEach((faqIntro, index) => {
    const faqContent = faqIntro.parentElement.querySelector("[data-faq-content]");
    
    // Set initial ARIA attributes
    faqIntro.setAttribute("aria-expanded", "false");
    faqIntro.setAttribute("aria-controls", `faq-content-${index}`);
    faqContent.setAttribute("aria-hidden", "true");
    faqContent.id = `faq-content-${index}`;

    // Click event
    faqIntro.addEventListener("click", () => toggleAccordion(faqIntro, faqContent));

    // Keyboard accessibility
    faqIntro.setAttribute("tabindex", "0");
    faqIntro.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        toggleAccordion(faqIntro, faqContent);
      }
    });
  });

  // Open the first accordion by default
  if (faqIntros.length > 0) {
    const firstIntro = faqIntros[0];
    const firstContent = firstIntro.parentElement.querySelector("[data-faq-content]");
    firstIntro.classList.add("active");
    firstIntro.setAttribute("aria-expanded", "true");
    firstContent.classList.add("active");
    firstContent.setAttribute("aria-hidden", "false");
    firstContent.style.maxHeight = `${firstContent.scrollHeight}px`;
  }
};

// Initialize when DOM is loaded
document.addEventListener("DOMContentLoaded", initAccordion);
</script>

{% schema %}
{
  "name": "Product Content Block",
  "class": "product-details-new",
  "enabled_on": {
    "templates": ["product"]
  },
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full Width Section",
      "default": false
    },
    {
      "type": "header",
      "content": "Section Spacing Desktop"
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Top",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 48
    },
    {
      "type": "header",
      "content": "Section Spacing Mobile"
    },
    {
      "type": "range",
      "id": "margin_top_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Top",
      "default": 32
    },
    {
      "type": "range",
      "id": "padding_bottom_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 32
    }
  ],
  "blocks": [
    {
      "type": "info",
      "name": "Info",
      "limit": 3,
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Info Title",
          "default": "MATERIAL"
        },
        {
          "type": "richtext",
          "id": "info",
          "label": "Info Description"
        }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Description"
        },
        {
          "type": "richtext",
          "id": "rte",
          "label": "Richtext"
        }
      ]
    },
    {
      "type": "image",
      "name": "Image",
      "limit": 3,
      "settings": [
        {
          "type": "image_picker",
          "id": "img",
          "label": "Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Content Block"
    }
  ]
}
{% endschema %}
